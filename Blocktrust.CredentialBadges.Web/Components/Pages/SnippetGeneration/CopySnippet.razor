@page "/copysnippet/{credentialId:guid}/{selectedTemplateId}"
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<div class="relative min-h-screen w-screen bg-[#F0F1F2] flex items-center justify-center">
    <!-- Corner images -->
    <img src="/images/InputPageRectangle.svg" alt="" class="absolute top-36 left-36 w-16 h-16">
    <img src="/images/InputPageTriangle.svg" alt="" class="absolute top-24 right-24 w-16 h-16">
    <img src="/images/InputPageTriangle.svg" alt="" class="absolute bottom-24 left-24 w-16 h-16">
    <img src="/images/InputPageRectangle.svg" alt="" class="absolute bottom-36 right-36 w-16 h-16">
    <!-- Content container -->
    
    <div class="flex flex-col bg-[#FAFAFA] border border-gray-200 rounded-lg shadow-md backdrop-filter backdrop-blur-sm p-8 max-w-[42rem]">
        <h1 class="text-2xl font-bold text-[#334155] mb-4">Copy Code Snippet</h1>
        <p class="text-[#334155] mb-6">
            Use this code snippet to display your credential badge on your website.
        </p>
        
        <div class="bg-gray-100 rounded-lg p-4 mb-6">
            <div class="flex justify-between items-center mb-2">
                <span class="text-[#334155] font-medium">HTML</span>
                <button @onclick="CopySnippetToClipboard" class="text-[#334155] hover:text-[#475569]">
                    <span class="material-symbols-outlined">content_copy</span>
                </button>
            </div>
            <pre class="bg-white p-4 rounded-md overflow-x-auto"><code class="text-sm text-[#334155]">@snippetCode</code></pre>
        </div>
        
        <a 
            href="@($"/previewbadge/{credentialId}")"
            class="bg-[#334155] text-[#F8FAFC] font-medium py-2 px-4 rounded-md hover:bg-[#475569] transition-colors self-center no-underline text-center">
            Go Back
        </a>
    </div>
</div>

<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

@code {
    [Parameter] public Guid credentialId { get; set; }
    [Parameter] public string selectedTemplateId { get; set; }
    private string snippetCode = string.Empty;
    private string domain = "http://localhost:5159";

    protected override void OnInitialized()
    {
        GenerateSnippet();
    }

    private void GenerateSnippet()
    {
        snippetCode = $@"<div id='blocktrust-badge' data-id='{credentialId}' data-template='{selectedTemplateId}'></div><script src='{domain}/badge-loader.js'></script>";
    }


    private async Task CopySnippetToClipboard()
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", snippetCode);
            await JSRuntime.InvokeVoidAsync("alert", "Snippet copied to clipboard!");
        }
        catch (Exception)
        {
            await JSRuntime.InvokeVoidAsync("alert", "Failed to copy snippet. Please try again.");
        }
    }
}